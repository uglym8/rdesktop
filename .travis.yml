dist: trusty

language: c

compiler: gcc

# safelist
branches:
  only:
  - integration

env:
  global:

addons:
  coverity_scan:
    project:
      name: "uglym8/rdesktop"
      description: "Unix client for Microsoft Remote Desktop Services. http://www.rdesktop.org"
    notification_email: uglym8@gmail.com
    build_command_prepend: "./bootstrap && ./configure --disable-credssp --disable-smartcard"
    build_command:   "make"
    #branch_pattern: coverity_scan
    #branch_pattern: master
    branch_pattern: integration

addons:
  sonarqube:
  branches:
    - integration

#script: ./bootstrap && ./configure --disable-credssp --disable-smartcard && make

before_script:
- "./bootstrap"

script:
- "./configure --disable-credssp --disable-smartcard"
- build-wrapper-linux-x86-64 --out-dir build-wrapper-out make clean all
- sonar-scanner -X -Dsonar.host.url=https://sonarqube.com -Dsonar.login=$SONAR_TOKEN
